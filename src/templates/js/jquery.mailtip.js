'use strict';(function($){var INVALIDEMAILRE=/^[^A-Za-z0-9]+[a-zA-Z0-9]*$/;var hasInputEvent='oninput'in document.createElement('input');var ISIE9=/MSIE 9.0/i.test(window.navigator.appVersion||window.navigator.userAgent);function isNumber(value){return typeof value==='number'&&isFinite(value);}function createTip(input,config){var tip=null;if(!input.data('data-mailtip')){var wrap=input.parent();!/absolute|relative/i.test(wrap.css('position'))&&wrap.css('position','relative');input.attr('autocomplete','off');var offset=input.offset();var wrapOffset=wrap.offset();tip=$('<ul class="ui-mailtip" style="display: none; float: none; '+'position:absolute; margin: 0; padding: 0; z-index:100000; '+config.zIndex+'"></ul>');input.after(tip);tip.css({top:offset.top-wrapOffset.top+input.outerHeight()+config.offsetTop,left:offset.left-wrapOffset.left+config.offsetLeft,width:config.width==='input'?input.outerWidth()-tip.outerWidth()+tip.width():config.width});if(config.width==='auto'){tip.css('min-width',input.outerWidth()-tip.outerWidth()+tip.width());}tip.on('mouseenter mouseleave click','li',function(e){var selected=$(this);switch(e.type){case'mouseenter':selected.addClass('hover');break;case'click':var mail=selected.attr('title');input.val(mail).focus();config.onselected.call(input[0],mail);break;case'mouseleave':selected.removeClass('hover');break;default:break;}});$(document).on('click',function(e){if(e.target===input[0])return;tip.hide();});input.data('data-mailtip',tip);}return tip||input.data('data-mailtip');}function createItems(value,mails){var mail;var domain;var domainUpper;var items='';var atIndex=value.indexOf('@');var hasAt=atIndex!==-1;if(hasAt){domainUpper=value.toLowerCase();domain=domainUpper.substring(atIndex+1);value=value.substring(0,atIndex);}for(var i=0,len=mails.length;i<len;i++){mail=mails[i];if(hasAt&&mail.indexOf(domain)!==0)continue;items+='<li title="'+value+'@'+mail+'"><p>'+value+'@'+mail+'</p></li>';}return items.replace('<li','<li class="active"');}function changeActive(tip,up){var itemActive=tip.find('li.active');if(up){var itemPrev=itemActive.prev();itemPrev=itemPrev.length?itemPrev:tip.find('li:last');itemActive.removeClass('active');itemPrev.addClass('active');}else{var itemNext=itemActive.next();itemNext=itemNext.length?itemNext:tip.find('li:first');itemActive.removeClass('active');itemNext.addClass('active');}}function toggleTip(tip,value,mails){var atIndex=value.indexOf('@');if(!value||atIndex===0||atIndex!==value.lastIndexOf('@')||INVALIDEMAILRE.test(atIndex===-1?value:value.substring(0,atIndex))){tip.hide();}else{var items=createItems(value,mails);if(items){tip.html(items).show();}else{tip.hide();}}}$.fn.mailtip=function(config){var defaults={mails:['gmail.com','rediffmail.com','outlook.com','hotmail.com','yahoo.com','yahoo.co.in'],onselected:$.noop,width:'auto',offsetTop:-1,offsetLeft:0,zIndex:10};config=$.extend({},defaults,config);config.zIndex=isNumber(config.zIndex)?config.zIndex:defaults.zIndex;config.offsetTop=isNumber(config.offsetTop)?config.offsetTop:defaults.offsetTop;config.offsetLeft=isNumber(config.offsetLeft)?config.offsetLeft:defaults.offsetLeft;config.onselected=$.isFunction(config.onselected)?config.onselected:defaults.onselected;config.width=config.width==='input'||isNumber(config.width)?config.width:defaults.width;return this.each(function(){var input=$(this);var tip=createTip(input,config);input.on('keydown',function(e){if(tip.css('display')==='none')return;switch(e.keyCode){case 8:if(ISIE9){input.trigger('input');}break;case 9:tip.hide();break;case 38:e.preventDefault();changeActive(tip,true);break;case 40:e.preventDefault();changeActive(tip);break;case 13:e.preventDefault();var mail=tip.find('li.active').attr('title');input.val(mail).focus();tip.hide();config.onselected.call(this,mail);break;default:break;}});if(hasInputEvent){input.on('input',function(){toggleTip(tip,this.value,config.mails);});}else{input.on('propertychange',function(e){if(e.originalEvent.propertyName==='value'){toggleTip(tip,this.value,config.mails);}});}if(ISIE9){input.on('keyup',function(e){if(e.keyCode===8){toggleTip(tip,this.value,config.mails);}});}});};}(jQuery));